<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>markdown</title>
    <url>/2023/03/31/markdown/</url>
    <content><![CDATA[<h3 id="Basic-Syntax"><a href="#Basic-Syntax" class="headerlink" title="Basic Syntax"></a>Basic Syntax</h3><table>
<thead>
<tr>
<th>Element</th>
<th>Syntax</th>
</tr>
</thead>
<tbody><tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#headings" >Heading <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td># H1 <br> ## H2 <br> ### H3</td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#bold" >Bold <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td><strong>bold text</strong></td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#italic" >Italic <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td><em>italicized text</em></td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#blockquotes-1" >Blockquote <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>&gt; blockquote</td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#ordered-lists" >Ordered List <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>1. First item <br> 2. Second item <br> 3. Third item</td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#unordered-lists" >Unordered List <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>- First item <br> - Second item <br> - Third item</td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#code" >Code <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td><code>code</code></td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#horizontal-rules" >Horizontal Rule <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>â€”</td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#links" >Link <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td><a class="link"   href="https://www.example.com/" >title <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
</tr>
<tr>
<td><a class="link"   href="https://www.markdownguide.org/basic-syntax/#images-1" >Image <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/image.jpg"
                      alt="alt text"
                ></td>
</tr>
</tbody></table>
<h3 id="Extended-Syntax"><a href="#Extended-Syntax" class="headerlink" title="Extended Syntax"></a>Extended Syntax</h3><ul>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#tables" >Table <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">| Syntax | Description |</span><br><span class="line">| ----------- | ----------- |</span><br><span class="line">| Header | Title |</span><br><span class="line">| Paragraph | Text |</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#fenced-code-blocks" >Fenced Code Blocks <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;John&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Smith&quot;,</span><br><span class="line">  &quot;age&quot;: 25</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#footnotes" >Footnote <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#heading-ids" >Heading ID <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h5 id="custom-id">My Great Heading</h5>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#definition-lists" >Definition List <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">term</span><br><span class="line">: definition</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#strikethrough" >Strikethrough <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
</ul>
<p><code>~~The world is flat.~~</code></p>
<p><del>The world is flat.</del></p>
<ul>
<li><a class="link"   href="https://www.markdownguide.org/extended-syntax/#task-lists" >Task List <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">- [x] wre</span><br><span class="line">- [] dfs</span><br><span class="line">- [] fdsf</span><br></pre></td></tr></table></figure></div></li>
<li><input checked="" disabled="" type="checkbox"> wre</li>
<li>[] dfs</li>
<li>[] fdsf</li>
</ul>
<p>-<a class="link"   href="https://www.markdownguide.org/extended-syntax/#emoji" >Emoji <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">:joy:</span><br><span class="line">:smile:</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>see also <a class="link"   href="https://www.markdownguide.org/extended-syntax/#copying-and-pasting-emoji" >Copying and Pasting Emoji <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<p>-<a class="link"   href="https://www.markdownguide.org/extended-syntax/#highlight" >Highlight <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line">I need to highlight these <span class="tag">&lt;<span class="name">mark</span>&gt;</span>very important words<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>I need to highlight these <mark>very important words</mark></p>
<ul>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#subscript" >Subscript <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line">H<span class="tag">&lt;<span class="name">sub</span>&gt;</span>2<span class="tag">&lt;/<span class="name">sub</span>&gt;</span>O</span><br></pre></td></tr></table></figure></div>
<p>H<sub>2</sub>O</p>
</li>
<li><p><a class="link"   href="https://www.markdownguide.org/extended-syntax/#superscript" >Superscript <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
</ul>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line">X<span class="tag">&lt;<span class="name">sup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">sup</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>X<sup>2</sup></p>
]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>efk</title>
    <url>/2023/04/01/efk/</url>
    <content><![CDATA[<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line"></span><br><span class="line">apt install apt-transport-https</span><br><span class="line"></span><br><span class="line">apt install openjdk-11-jdk</span><br><span class="line"></span><br><span class="line">/etc/environment</span><br><span class="line"></span><br><span class="line">PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin&quot;</span><br><span class="line">JAVA_HOME=&quot;/usr/lib/jvm/java-11-openjdk-amd64&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg</span><br><span class="line"></span><br><span class="line">echo &quot;deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main&quot; | sudo tee /etc/apt/sources.list.d/elastic-8.x.list</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install elasticsearch</span><br><span class="line"></span><br><span class="line">/etc/elasticsearch/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">curl -X GET &quot;localhost:9200&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-bionic-td-agent3.sh | sh</span><br><span class="line"></span><br><span class="line">td-agent-gem install fluent-plugin-elasticsearch</span><br><span class="line">chown -R td-agent: /var/log/td-agent/</span><br><span class="line"></span><br><span class="line">systemctl restart td-agent.service</span><br><span class="line"></span><br><span class="line">update-rc.d td-agent defaults 95 10</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">cd /etc/td-agent/</span><br><span class="line">mv td-agent.conf td-agent.conf-default</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart td-agent.service</span><br><span class="line"></span><br><span class="line">mkdir /etc/td-agent/conf.d</span><br><span class="line"></span><br><span class="line">/etc/init.d/td-agent restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl status calyptia-fluentd.service</span><br><span class="line">curl -fsSL https://toolbelt.treasuredata.com/sh/install-ubuntu-jammy-td-agent4.sh | sh</span><br><span class="line">systemctl start td-agent.service</span><br><span class="line">systemctl status td-agent.service</span><br><span class="line"></span><br><span class="line">curl -X POST -d &#x27;json=&#123;&quot;json&quot;:&quot;message&quot;&#125;&#x27; http://localhost:8888/debug.test</span><br><span class="line">tail -n 1 /var/log/td-agent/td-agent.log</span><br><span class="line">apt install -V fluentd-ui</span><br><span class="line">/usr/sbin/td-agent-ui start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">apt-get install kibana</span><br><span class="line"></span><br><span class="line">systemctl enable kibana</span><br><span class="line"></span><br><span class="line">systemctl start kibana</span><br><span class="line"></span><br><span class="line">systemctl status kibana</span><br><span class="line"></span><br><span class="line">vi /etc/kibana/kibana.yml</span><br><span class="line"></span><br><span class="line">systemctl restart kibana</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="elasticsearch-config"><a href="#elasticsearch-config" class="headerlink" title="elasticsearch config"></a>elasticsearch config</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">discovery.seed_hosts: [ ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xpack.security.enabled: false</span><br><span class="line"></span><br><span class="line">xpack.security.enrollment.enabled: true</span><br><span class="line"></span><br><span class="line">xpack.security.http.ssl:</span><br><span class="line">  enabled: true</span><br><span class="line">  keystore.path: certs/http.p12</span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl:</span><br><span class="line">  enabled: true</span><br><span class="line">  verification_mode: certificate</span><br><span class="line">  keystore.path: certs/transport.p12</span><br><span class="line">  truststore.path: certs/transport.p12</span><br><span class="line">cluster.initial_master_nodes: [&quot;db-efk-rabbit-116&quot;]</span><br><span class="line"></span><br><span class="line">http.host: 0.0.0.0</span><br></pre></td></tr></table></figure></div>



<h3 id="fluentd-config"><a href="#fluentd-config" class="headerlink" title="fluentd config"></a>fluentd config</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;match td.*.*&gt;</span><br><span class="line">  @type tdlog</span><br><span class="line">  @id output_td</span><br><span class="line">  apikey YOUR_API_KEY</span><br><span class="line">  auto_create_table</span><br><span class="line">  &lt;buffer&gt;</span><br><span class="line">    @type file</span><br><span class="line">    path /var/log/td-agent/buffer/td</span><br><span class="line">  &lt;/buffer&gt;</span><br><span class="line">  &lt;secondary&gt;</span><br><span class="line">    @type file</span><br><span class="line">    path /var/log/td-agent/failed_records</span><br><span class="line">  &lt;/secondary&gt;</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match debug.**&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name ftest</span><br><span class="line">  type_name log</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  @type forward</span><br><span class="line">  @id input_forward</span><br><span class="line">  port 24224</span><br><span class="line">&lt;/source&gt;</span><br><span class="line">&lt;match dev_ws_rqrs&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name dev_ws_rqrs</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix dev_ws_rqrs</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match dev_queue&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name dev_queue</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix dev_queue</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match dev_service&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name dev_service</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix dev_service</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match sit_ws_rqrs&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name sit_ws_rqrs</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix sit_ws_rqrs</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match sit_queue&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name sit_queue</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix sit_queue</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match sit_service&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name sit_service</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix sit_service</span><br><span class="line">  logstash_dateformat %Y.%m</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match service&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name lg-uat-service</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix lg-uat-service</span><br><span class="line">  logstash_dateformat %Y.%m.%d.%H</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match queue&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name lg-uat-queue</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix lg-uat-queue</span><br><span class="line">  logstash_dateformat %Y.%m.%d.%H</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;match ws_rqrs&gt;</span><br><span class="line"> @type elasticsearch</span><br><span class="line">  host localhost</span><br><span class="line">  port 9200</span><br><span class="line">  index_name lg-uat-ws_rqrs</span><br><span class="line">  logstash_format true</span><br><span class="line">  logstash_prefix lg-uat-ws_rqrs</span><br><span class="line">  logstash_dateformat %Y.%m.%d.%H</span><br><span class="line">  keep_time_key true</span><br><span class="line">  time_key @timestamp</span><br><span class="line">  time_key_format %Y-%m-%d %H:%M:%S.%L</span><br><span class="line">  type_name log</span><br><span class="line">  buffer_type memory</span><br><span class="line">  flush_interval 10s</span><br><span class="line">  template_name template_1</span><br><span class="line">&lt;/match&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  @type http</span><br><span class="line">  @id input_http</span><br><span class="line">  port 8888</span><br><span class="line">&lt;/source&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  @type debug_agent</span><br><span class="line">  @id input_debug_agent</span><br><span class="line">  bind 127.0.0.1</span><br><span class="line">  port 24230</span><br><span class="line">&lt;/source&gt;</span><br><span class="line">include config.d/*.conf</span><br></pre></td></tr></table></figure></div>

<h3 id="kibana-config"><a href="#kibana-config" class="headerlink" title="kibana config"></a>kibana config</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;192.168.26.116&quot;</span><br><span class="line">elasticsearch.hosts: [&quot;http://192.168.26.116:9200&quot;]</span><br><span class="line">xpack.encryptedSavedObjects.encryptionKey: ec6cf6f9e4e2b1b0332d0a64d7574fd8</span><br><span class="line">xpack.reporting.encryptionKey: 3a17e1c9abf16cd1d46725d0373b6247</span><br><span class="line">xpack.security.encryptionKey: bfc5ee4639f74f2667f76457c0946f96</span><br><span class="line">logging:</span><br><span class="line">  appenders:</span><br><span class="line">    file:</span><br><span class="line">      type: file</span><br><span class="line">      fileName: /var/log/kibana/kibana.log</span><br><span class="line">      layout:</span><br><span class="line">        type: json</span><br><span class="line">  root:</span><br><span class="line">    appenders:</span><br><span class="line">      - default</span><br><span class="line">      - file</span><br><span class="line">pid.file: /run/kibana/kibana.pid</span><br></pre></td></tr></table></figure></div>



]]></content>
      <tags>
        <tag>middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>fstab</title>
    <url>/2023/04/01/fstab/</url>
    <content><![CDATA[<h3 id="mount-device"><a href="#mount-device" class="headerlink" title="mount device"></a>mount device</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">lsblk</span><br><span class="line">mkfs.ext4 -m 0 -E lazy_itable_init=0,lazy_journal_init=0,discard /dev/DEVICE_NAME</span><br><span class="line"></span><br><span class="line">mkdir -p /mnt/disks/MOUNT_DIR</span><br><span class="line"></span><br><span class="line">mount -o discard,defaults /dev/DEVICE_NAME /mnt/disks/MOUNT_DIR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">blkid /dev/DEVICE_NAME</span><br></pre></td></tr></table></figure></div>

<h3 id="config-x2F-etc-x2F-fstab"><a href="#config-x2F-etc-x2F-fstab" class="headerlink" title="config &#x2F;etc&#x2F;fstab"></a>config &#x2F;etc&#x2F;fstab</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">UUID=UUID_VALUE /mnt/disks/MOUNT_DIR ext4 discard,defaults,nofail 0 2</span><br></pre></td></tr></table></figure></div>
<p>or</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">UUID=UUID_VALUE /mnt/disks/MOUNT_DIR ext4 discard,defaults,nobootwait 0 2</span><br></pre></td></tr></table></figure></div>




]]></content>
      <tags>
        <tag>os</tag>
      </tags>
  </entry>
  <entry>
    <title>kubeclt</title>
    <url>/2023/03/31/kubectl/</url>
    <content><![CDATA[<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">curl -LO &quot;https://dl.k8s.io/release/v1.25.4bin/darwin/arm64/kubectl</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="set-default-ns"><a href="#set-default-ns" class="headerlink" title="set default ns"></a>set default ns</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl config current-context</span><br><span class="line">kubectl config set-context $(kubectl config current-context) --namespace=example-namespace</span><br></pre></td></tr></table></figure></div>

<h3 id="get-secret"><a href="#get-secret" class="headerlink" title="get secret"></a>get secret</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get secrets/mysql-secret -o json | jq &#x27;.data | map_values(@base64d)&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="create-secret"><a href="#create-secret" class="headerlink" title="create secret"></a>create secret</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">cDVkQm16QjI3Yk5WMkRrdg==</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">livegame</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl  create secret generic mysql-secret --from-literal=password=&#x27;12qw!@QW&#x27; --from-literal=username=&quot;maya_live_uat&quot;</span><br><span class="line">kubectl  create secret generic mongo-secret --from-literal=password=&quot;Kn5Sq2XEftd3&quot; --from-literal=username=&quot;maya_live_uat&quot;</span><br><span class="line">kubectl  create secret generic redis-secret --from-literal=password=&quot;p5dBmzB27bNV2Dkv&quot;</span><br><span class="line">kubectl  create secret generic rabbitmq-secret --from-literal=password=&quot;bDtK7OMwz0EzxTBgx&quot; --from-literal=username=&quot;baisha&quot;</span><br><span class="line">kubectl  create secret generic minio-secret --from-literal=password=&quot;2VjVSLQM0Ff1&quot; --from-literal=username=&quot;baisha&quot;</span><br><span class="line"></span><br><span class="line">kubectl  create secret docker-registry harbor --docker-server=harbor.mogm.online --docker-username=&quot;admin&quot; --docker-password=&quot;Harbor12345&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="create-dockerconfigjson"><a href="#create-dockerconfigjson" class="headerlink" title="create dockerconfigjson"></a>create dockerconfigjson</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">cat ~/.docker/config.json | base64 -w0</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">.dockerconfigjson:</span> <span class="string">eyJhdXRocyI6eyJoYXJib3IubW9nbS5vbmxpbmUiOnsidXNlcm5hbWUiOiJhZG1pbiIsInBhc3N3b3JkIjoiSGFyYm9yMTIzNDUiLCJhdXRoIjoiWVdSdGFXNDZTR0Z5WW05eU1USXpORFU9In19fQ==</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">harbor</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">livegame</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/dockerconfigjson</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="scale"><a href="#scale" class="headerlink" title="scale"></a>scale</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">for file in $(kubectl -n livegame get deployments.apps | grep 1/1 | awk &#x27;&#123;print $1&#125;&#x27; | sed &#x27;s/-deployment//&#x27;) \</span><br><span class="line">do \</span><br><span class="line">kubectl scale --replicas=3 -f $&#123;file&#125;.yml\</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="create-configmap"><a href="#create-configmap" class="headerlink" title="create configmap"></a>create configmap</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">kubectl -n livegame create configmap application --from-file=application.yml</span><br><span class="line">kubectl -n livegame  create configmap pay-bootstrap --from-file=bootstrap.yml</span><br><span class="line">kubectl -n livegame  create configmap pay-conf --from-file=config.conf</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="cloudflare-real-ip-set"><a href="#cloudflare-real-ip-set" class="headerlink" title="cloudflare real ip set"></a>cloudflare real ip set</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">allow-snippet-annotations:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">forwarded-for-header:</span> <span class="string">X-Forwarded-For</span></span><br><span class="line">  <span class="attr">proxy-buffer-size:</span> <span class="string">16k</span></span><br><span class="line">  <span class="attr">proxy-buffers-number:</span> <span class="string">&quot;8&quot;</span></span><br><span class="line">  <span class="attr">real-ip-header:</span> <span class="string">CF-Connecting-IP</span></span><br><span class="line">  <span class="attr">set-real-ip-from:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">  <span class="attr">use-forwarded-headers:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">meta.helm.sh/release-name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">meta.helm.sh/release-namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.7</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">helm.sh/chart:</span> <span class="string">ingress-nginx-4.6.0</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



]]></content>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>rabbitmq</title>
    <url>/2023/03/31/rabbitmq/</url>
    <content><![CDATA[<h3 id="log-level-set"><a href="#log-level-set" class="headerlink" title="log level set"></a>log level set</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">rabbitmqctl -n rabbit@ip-172-31-25-238 set_log_level debug</span><br></pre></td></tr></table></figure></div>

<h3 id="rabbitmqadmin-download"><a href="#rabbitmqadmin-download" class="headerlink" title="rabbitmqadmin download"></a>rabbitmqadmin download</h3><p><code>/cli/rabbitmqadmin</code></p>
<h3 id="publish-message"><a href="#publish-message" class="headerlink" title="publish message"></a>publish message</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">python rabbitmqadmin -u admin -p &#x27;12qw!@QW&#x27; publish exchange=amq.default routing_key=hello_queue payload=&quot;hello, world&quot;</span><br></pre></td></tr></table></figure></div>

<h3 id="consume-message"><a href="#consume-message" class="headerlink" title="consume message"></a>consume message</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">python rabbitmqadmin -u admin -p &#x27;12qw!@QW&#x27; get queue=hello_queue ackmode=ack_requeue_false</span><br></pre></td></tr></table></figure></div>
<p>or</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">python rabbitmqadmin -u admin -p &#x27;12qw!@QW&#x27; get queue=hello_queue</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
]]></content>
      <tags>
        <tag>middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>sublime-text</title>
    <url>/2023/04/01/sublime-text/</url>
    <content><![CDATA[<h3 id="Useful-Packages"><a href="#Useful-Packages" class="headerlink" title="Useful Packages"></a>Useful Packages</h3><ul>
<li>Package Control.sublime-package</li>
<li>MarkdownPreview.sublime-package</li>
<li>Terminus<ul>
<li>settings  <div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;caption&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Terminal (panel)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;terminus_open&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span>   <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zsh&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;file_path:$&#123;folder&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Command Prompt&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;panel_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Terminus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div></li>
<li>keybinding   <div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;alt+1&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;terminus_open&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;args&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zsh&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;file_path:$&#123;folder&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;panel_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Terminus&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h3 id="Custom-settings"><a href="#Custom-settings" class="headerlink" title="Custom settings"></a>Custom settings</h3><pre><code class="json">&#123;
    &quot;save_on_focus_lost&quot;: true
&#125;

</code></pre>
]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo</title>
    <url>/2023/03/31/hexo/</url>
    <content><![CDATA[<h3 id="install-hexo-cli"><a href="#install-hexo-cli" class="headerlink" title="install hexo cli"></a>install hexo cli</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure></div>


<h3 id="verify-hexo-version"><a href="#verify-hexo-version" class="headerlink" title="verify hexo version"></a>verify hexo version</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure></div>

<h3 id="initilize-a-blog-site"><a href="#initilize-a-blog-site" class="headerlink" title="initilize a blog site"></a>initilize a blog site</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure></div>

<h3 id="test-the-default"><a href="#test-the-default" class="headerlink" title="test the default"></a>test the default</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure></div>

<h3 id="install-theme"><a href="#install-theme" class="headerlink" title="install theme"></a>install theme</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-theme-redefine@latest</span><br></pre></td></tr></table></figure></div>

<h3 id="update-theme"><a href="#update-theme" class="headerlink" title="update theme"></a>update theme</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm update hexo-theme-redefine</span><br></pre></td></tr></table></figure></div>

<h3 id="confg-config-yml"><a href="#confg-config-yml" class="headerlink" title="confg config.yml"></a>confg config.yml</h3><div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">redefine</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/sunnyy02/sunnyy02.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure></div>

<h3 id="install-deploy-plugin"><a href="#install-deploy-plugin" class="headerlink" title="install deploy plugin"></a>install deploy plugin</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></div>

<h3 id="install-hexo-browsersync-plugin"><a href="#install-hexo-browsersync-plugin" class="headerlink" title="install hexo-browsersync plugin"></a>install hexo-browsersync plugin</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-browsersync --save</span><br></pre></td></tr></table></figure></div>

<h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><ul>
<li><p>new post</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>run local </p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure></div>
<p>or</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo server --draft --open</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>generate static files</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>deploy to remote </p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></div></li>
</ul>
]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode</title>
    <url>/2023/04/03/vscode/</url>
    <content><![CDATA[<h3 id="Extensions"><a href="#Extensions" class="headerlink" title="Extensions"></a>Extensions</h3><ul>
<li>Draw.io Integration</li>
<li>Live Server</li>
</ul>
]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>git</title>
    <url>/2023/04/03/git/</url>
    <content><![CDATA[<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;zero&quot;</span><br><span class="line">git config --global user.email &quot;zero@Zeros-Mac-mini.local&quot;</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>google-cloud-cli</title>
    <url>/2023/04/03/google-cloud-cli/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">gcloud components install kubectl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gcloud compute routers create vpc-grp-router \</span><br><span class="line">    --project=blue-372407 \</span><br><span class="line">    --network=vpc-grp \</span><br><span class="line">    --region=asia-east2 \</span><br><span class="line">    --set-advertisement-groups all_subnets</span><br><span class="line"></span><br><span class="line">gcloud compute addresses list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gcloud compute routers nats create vpc-grp-nat --router=vpc-grp-router --nat-all-subnet-ip-ranges --nat-external-ip-pool=test --nat-all-subnet-ip-ranges</span><br><span class="line"></span><br><span class="line">gcloud compute url-maps list</span><br><span class="line"></span><br><span class="line">gcloud compute target-pools list</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>github-cli</title>
    <url>/2023/04/03/github-cli/</url>
    <content><![CDATA[<h3 id="install-and-upgrade"><a href="#install-and-upgrade" class="headerlink" title="install and upgrade"></a>install and upgrade</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">brew install gh</span><br><span class="line">brew upgrade gh</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">gh auth login</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="auto-completion"><a href="#auto-completion" class="headerlink" title="auto completion"></a>auto completion</h3><ul>
<li>bash<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">eval &quot;$(gh completion -s bash)&quot;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>-zsh</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">gh completion -s zsh &gt; /usr/local/share/zsh/site-functions/_gh</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>ansible</title>
    <url>/2023/04/03/ansible/</url>
    <content><![CDATA[<blockquote>
<p><a class="link"   href="https://docs.ansible.com/ansible/latest/command_guide/cheatsheet.html" >https://docs.ansible.com/ansible/latest/command_guide/cheatsheet.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
]]></content>
      <tags>
        <tag>automation</tag>
      </tags>
  </entry>
  <entry>
    <title>helm</title>
    <url>/2023/04/03/helm/</url>
    <content><![CDATA[<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><ul>
<li>script</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</span><br><span class="line">chmod 700 get_helm.sh</span><br><span class="line">./get_helm.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li>source code<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">git clone https://github.com/helm/helm.git</span><br><span class="line">cd helm</span><br><span class="line">make</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">A chart repository (as we&#x27;ve seen above)</span><br><span class="line">A local chart archive (helm install foo foo-0.1.1.tgz)</span><br><span class="line">An unpacked chart directory (helm install foo path/to/foo)</span><br><span class="line">A full URL (helm install foo https://example.com/charts/foo-1.2.3.tgz)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>nfs</title>
    <url>/2023/04/03/nfs/</url>
    <content><![CDATA[<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">yum install nfs-utils -y</span><br><span class="line"></span><br><span class="line">mkdir /var/nfs_share_dir</span><br><span class="line"></span><br><span class="line">chmod -R 755 /var/nfs_share_dir</span><br><span class="line">chown nfsnobody:nfsnobody /var/nfs_share_di</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl enable rpcbind &amp;&amp; systemctl enable nfs-server &amp;&amp; systemctl enable nfs-lock &amp;&amp; systemctl enable nfs-idmap</span><br><span class="line">systemctl start rpcbind &amp;&amp; systemctl start nfs-server &amp;&amp; systemctl start nfs-lock &amp;&amp; systemctl start nfs-idmap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi /etc/exports</span><br><span class="line"></span><br><span class="line">/home/nfs    172.16.0.0/16(rw,sync,no_root_squash)</span><br><span class="line"></span><br><span class="line">systemctl restart nfs-server</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p><code>/etc/exports/</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">/nfs *(insecure,rw,sync,no_root_squash)</span><br></pre></td></tr></table></figure></div>


<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">yum install nfs-utils</span><br><span class="line"></span><br><span class="line">mkdir -p /mnt/nfs/var/nfs_share_dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mount -t nfs 192.168.48.100:/var/nfs_share_dir /mnt/nfs/var/nfs_share_dir</span><br><span class="line"></span><br><span class="line">-t  type of filesystem</span><br><span class="line">192.168.48.100 server&#x27;s IP</span><br><span class="line"></span><br><span class="line">192.168.48.100:/var/nfs_share_dir /mnt/nfs/var/nfs_share_dir nfs defaults 0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <tags>
        <tag>os</tag>
      </tags>
  </entry>
  <entry>
    <title>prometheus</title>
    <url>/2023/04/03/prometheus/</url>
    <content><![CDATA[<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">helm install prometheus prometheus-community/prometheus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">helm repo add stable https://charts.helm.sh/stable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>monitoring</tag>
      </tags>
  </entry>
  <entry>
    <title>jq.md</title>
    <url>/2023/04/06/jq-md/</url>
    <content><![CDATA[<p><a class="link"   href="http://192.168.26.31:8080/api/json?tree=jobs%5Bname,color%5D" >http://192.168.26.31:8080/api/json?tree=jobs[name,color] <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>for job_name in $(jq .jobs job.list | jq â€˜.[] | .name â€˜);do job_name2&#x3D;$(echo $job_name | sed â€˜s&#x2F;â€œ&#x2F;&#x2F;gâ€™); curl â€“user zero:11152eda067e105864a2ae22002afa3392 -X GET <a class="link"   href="http://192.168.26.31:8080/job/$job_name2/config.xml" >http://192.168.26.31:8080/job/$job_name2/config.xml <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> -o $job_name2.xml ;done</p>
]]></content>
  </entry>
  <entry>
    <title>nginx</title>
    <url>/2023/04/07/nginx/</url>
    <content><![CDATA[<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><ul>
<li><p>ansible yaml</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">hqq-dev-proxy-01</span></span><br><span class="line">    <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">become_user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">become_method:</span> <span class="string">sudo</span></span><br><span class="line">    <span class="attr">vars:</span></span><br><span class="line">      <span class="attr">a:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="string">repo</span> <span class="string">copy</span></span><br><span class="line">        <span class="attr">template:</span></span><br><span class="line">          <span class="attr">src:</span> <span class="string">nginx/nginx.repo</span></span><br><span class="line">          <span class="attr">dest:</span> <span class="string">/etc/yum.repos.d/nginx.repo</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="string">install</span></span><br><span class="line">        <span class="attr">yum:</span></span><br><span class="line">          <span class="attr">name:</span> [<span class="string">&#x27;nginx-module-geoip&#x27;</span>, <span class="string">&#x27;nginx&#x27;</span>]</span><br><span class="line">          <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">          <span class="attr">update_cache:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">service</span> <span class="string">reload</span></span><br><span class="line">        <span class="attr">systemd:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">state:</span> <span class="string">reload</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># - de<span class="doctag">bug:</span></span></span><br><span class="line">      <span class="comment">#     var: result</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>nginx.repo</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">```conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### config</span><br><span class="line"></span><br><span class="line">- nginx.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>#load_module modules&#x2F;ngx_http_geoip_module.so;<br>load_module modules&#x2F;ngx_http_geoip_module-debug.so;<br>user  nginx;<br>worker_processes auto;</p>
<p>error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;<br>pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;<br>worker_rlimit_nofile 512000;</p>
<p>events {<br>    use epoll;<br>    worker_connections  512000;<br>    multi_accept on;</p>
<p>}<br>http<br>    {<br>        include       mime.types;<br>        default_type  application&#x2F;octet-stream;</p>
<pre><code>    #geoip_country  /usr/share/GeoIP/GeoLiteCountry.dat;
    #geoip_city    /usr/share/GeoIP/GeoLiteCity.dat;

    fastcgi_param GEOIP_CITY_COUNTRY_CODE $geoip_city_country_code;
    fastcgi_param GEOIP_CITY_COUNTRY_CODE3 $geoip_city_country_code3;
    fastcgi_param GEOIP_CITY_COUNTRY_NAME $geoip_city_country_name;
    fastcgi_param GEOIP_REGION $geoip_region;
    fastcgi_param GEOIP_CITY $geoip_city;
    fastcgi_param GEOIP_POSTAL_CODE $geoip_postal_code;
    fastcgi_param GEOIP_CITY_CONTINENT_CODE $geoip_city_continent_code;
    fastcgi_param GEOIP_LATITUDE $geoip_latitude;
    fastcgi_param GEOIP_LONGITUDE $geoip_longitude;

    server_names_hash_bucket_size 512;
    client_header_buffer_size 32k;
    large_client_header_buffers 4 32k;
    client_max_body_size 50m;
    proxy_headers_hash_max_size 51200;
    proxy_headers_hash_bucket_size 6400;


    sendfile   on;
    tcp_nopush on;

    keepalive_timeout 60;
    tcp_nodelay on;

    fastcgi_connect_timeout 300;
    fastcgi_send_timeout 300;
    fastcgi_read_timeout 300;
    fastcgi_buffer_size 64k;
    fastcgi_buffers 4 64k;
    fastcgi_busy_buffers_size 128k;
    fastcgi_temp_file_write_size 256k;

    gzip on;
    gzip_min_length  1k;
    gzip_buffers     4 16k;
    gzip_http_version 1.1;
    gzip_comp_level 2;
    gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml application/xml+rss;
    gzip_vary on;
    gzip_proxied   expired no-cache no-store private auth;
    gzip_disable   &quot;MSIE [1-6]\.&quot;;

    #limit_conn_zone $binary_remote_addr zone=perip:10m;
    ##If enable limit_conn_zone,add &quot;limit_conn perip 10;&quot; to server section.

    server_tokens off;

    set_real_ip_from 0.0.0.0/0;
    real_ip_header  X-Forwarded-For;
    log_format  main  &#39;$remote_addr $http_x_forwarded_for [$time_local] &quot;$request&quot; &#39;
    &#39;$status $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot; &#39;
    &#39;$request_time $upstream_response_time $host $server_port    &quot;$geoip_country_name&quot;  - &quot;$geoip_region&quot;  - &quot;$geoip_city&quot;&#39;;

    log_format  json escape=json
    &#39;&#123;&quot;timestamp&quot;:&quot;$time_local&quot;,&#39;
    &#39;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &#39;
    &#39;&quot;remote_user&quot;: &quot;$remote_user&quot;, &#39;
    &#39;&quot;body_bytes_sent&quot;: &quot;$body_bytes_sent&quot;, &#39;
    &#39;&quot;request_time&quot;: &quot;$request_time&quot;, &#39;
    &#39;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot; ,&#39;
    &#39;&quot;upstream_addr&quot;: &quot;$upstream_addr&quot;, &#39;
    &#39;&quot;status&quot;: &quot;$status&quot;, &#39;
    &#39;&quot;request&quot;: &quot;$request&quot;, &#39;
    &#39;&quot;request_body&quot;: &quot;$request_body&quot;,&#39;
    &#39;&quot;request_method&quot;: &quot;$request_method&quot;, &#39;
    &#39;&quot;http_referrer&quot;: &quot;$http_referer&quot;, &#39;
    &#39;&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;, &#39;
    &#39;&quot;http_x_forwarded_for&quot;: &quot;$http_x_forwarded_for&quot;, &#39;
    #&#39;&quot;http_cdn_src_ip&quot;: &quot;$http_cdn_src_ip&quot;, &#39;
    &#39;&quot;http_user_agent&quot;: &quot;$http_user_agent&quot;, &#39;
    &#39;&quot;request_host&quot;: &quot;$host&quot;, &#39;
    &#39;&quot;scheme&quot;: &quot;$scheme&quot;, &#39;
    &#39;&quot;country_name&quot;: &quot;$geoip_country_name&quot;, &#39;
    &#39;&quot;region&quot;: &quot;$geoip_region&quot;, &#39;
    &#39;&quot;cityname&quot;: &quot;$geoip_city&quot;&#39;
    #&#39;&quot;$name&quot;: &quot;$value&quot;&#39;
    &#39;&#125;&#39;;


    log_format  platform
    &#39;&#123;&quot;timestamp&quot;:&quot;$time_local&quot;,&#39;
    &#39;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &#39;
    &#39;&quot;remote_user&quot;: &quot;$remote_user&quot;, &#39;
    &#39;&quot;body_bytes_sent&quot;: &quot;$body_bytes_sent&quot;, &#39;
    &#39;&quot;request_time&quot;: &quot;$request_time&quot;, &#39;
    &#39;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot; ,&#39;
    &#39;&quot;upstream_addr&quot;: &quot;$upstream_addr&quot;, &#39;
    &#39;&quot;status&quot;: &quot;$status&quot;, &#39;
    &#39;&quot;request&quot;: &quot;$request&quot;, &#39;
    &#39;&quot;request_body&quot;: &quot;$request_body&quot;,&#39;
    &#39;&quot;request_method&quot;: &quot;$request_method&quot;, &#39;
    &#39;&quot;http_referrer&quot;: &quot;$http_referer&quot;, &#39;
    &#39;&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;, &#39;
    &#39;&quot;http_x_forwarded_for&quot;: &quot;$http_x_forwarded_for&quot;, &#39;
    #&#39;&quot;http_cdn_src_ip&quot;: &quot;$http_cdn_src_ip&quot;, &#39;
    &#39;&quot;http_user_agent&quot;: &quot;$http_user_agent&quot;, &#39;
    &#39;&quot;request_host&quot;: &quot;$host&quot;, &#39;
    &#39;&quot;country_name&quot;: &quot;$geoip_country_name&quot;, &#39;
    &#39;&quot;region&quot;: &quot;$geoip_region&quot;, &#39;
    &#39;&quot;cityname&quot;: &quot;$geoip_city&quot;, &#39;
    &#39;&quot;hostname&quot;: &quot;$hostname&quot; &#39;
    &#39;&quot;location_proxy&quot;: &quot;$http_location_proxy&quot; &#39;
    &#39;&#125;&#39;;


    access_log /var/log/nginx/access.log;

    include conf.d/*.conf;
</code></pre>
<p>}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- location</span><br><span class="line"></span><br><span class="line">```conf</span><br><span class="line"></span><br><span class="line">https://www.jianshu.com/p/a16936455018</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>fastcgi_param</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">fastcgi_param GEOIP_CITY_COUNTRY_CODE $geoip_city_country_code;</span><br><span class="line">fastcgi_param GEOIP_CITY_COUNTRY_CODE3 $geoip_city_country_code3;</span><br><span class="line">fastcgi_param GEOIP_CITY_COUNTRY_NAME $geoip_city_country_name;</span><br><span class="line">fastcgi_param GEOIP_REGION $geoip_region;</span><br><span class="line">fastcgi_param GEOIP_CITY $geoip_city;</span><br><span class="line">fastcgi_param GEOIP_POSTAL_CODE $geoip_postal_code;</span><br><span class="line">fastcgi_param GEOIP_CITY_CONTINENT_CODE $geoip_city_continent_code;</span><br><span class="line">fastcgi_param GEOIP_LATITUDE $geoip_latitude;</span><br><span class="line">fastcgi_param GEOIP_LONGITUDE $geoip_longitude;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

</li>
<li><p>proxy_set_header</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_set_header  X-Client-Verify SUCCESS;</span><br><span class="line">proxy_set_header  X-Client-DN   $ssl_client_s_dn;</span><br><span class="line">proxy_set_header  X-SSL-Subject  $ssl_client_s_dn;</span><br><span class="line">proxy_set_header  X-SSL-Issuer   $ssl_client_i_dn;</span><br><span class="line">proxy_set_header  Upgrade     $http_upgrade;</span><br><span class="line">proxy_set_header  Connection    &quot;upgrade&quot;;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Real-PORT $remote_port;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header Scheme $scheme;</span><br><span class="line">proxy_set_header Server-Protocol $server_protocol;</span><br><span class="line">proxy_set_header Server-Name $server_name;</span><br><span class="line">proxy_set_header Server-Addr $server_addr;</span><br><span class="line">proxy_set_header Server-Port $server_port;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<ul>
<li><p>geoip</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">[ref1](https://dev.maxmind.com/geoip/)</span><br><span class="line">[ref2](https://github.com/leev/ngx_http_geoip2_module/blob/master/README.md#installing)</span><br><span class="line">[ref3](https://medium.com/@karljohnson/geoip-discontinuation-upgrade-to-geoip2-with-nginxon-centos-c2a3dbcf8fd)</span><br><span class="line"></span><br><span class="line">yum -y install https://repo.aerisnetwork.com/pub/aeris-release-7.rpm</span><br><span class="line">yum install nginx-more</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">load_module modules/ngx_http_geoip_module-debug.so;</span><br><span class="line"></span><br><span class="line">geoip_country  /usr/share/GeoIP/GeoLiteCountry.dat;</span><br><span class="line">geoip_city    /usr/share/GeoIP/GeoLiteCity.dat;</span><br></pre></td></tr></table></figure></div>

</li>
<li><p>monitoring</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /nginx_status &#123;</span><br><span class="line">        stub_status;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>amplify</p>
</li>
<li><p>add_header</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>proxy_set_header</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_set_header   Host $host;</span><br><span class="line">proxy_set_header X-Scheme $scheme;</span><br><span class="line">proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">proxy_set_header X-Forwarded-Proto      $pass_access_scheme;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>ulimit</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">worker_rlimit_nofile    50000;</span><br></pre></td></tr></table></figure></div>

<p>&#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;nginx-limits.conf</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginx soft nofile 30000</span><br><span class="line">nginx hard nofile 50000</span><br></pre></td></tr></table></figure></div>


<ul>
<li>geoip</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">load_module modules/ngx_http_geoip_module.so;</span><br><span class="line"></span><br><span class="line">geoip_country       /etc/nginx/geoip/GeoIP.dat;</span><br><span class="line">geoip_city          /etc/nginx/geoip/GeoLiteCity.dat;</span><br><span class="line">geoip_org           /etc/nginx/geoip/GeoIPASNum.dat;</span><br><span class="line">geoip_proxy_recursive on;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>gzip</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">    gzip on;</span><br><span class="line">gzip_comp_level 5;</span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line">gzip_min_length 256;</span><br><span class="line">gzip_types application/atom+xml application/javascript application/x-javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/svg+xml image/x-icon text/css text/javascript text/plain text/x-component;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>log format</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">log_format  json escape=json</span><br><span class="line">        &#x27;&#123;&quot;timestamp&quot;:&quot;$time_local&quot;,&#x27;</span><br><span class="line">        &#x27;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;remote_user&quot;: &quot;$remote_user&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;body_bytes_sent&quot;: &quot;$body_bytes_sent&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;request_time&quot;: &quot;$request_time&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot; ,&#x27;</span><br><span class="line">        &#x27;&quot;upstream_addr&quot;: &quot;$upstream_addr&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;status&quot;: &quot;$status&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;request&quot;: &quot;$request&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;request_body&quot;: &quot;$request_body&quot;,&#x27;</span><br><span class="line">        &#x27;&quot;request_method&quot;: &quot;$request_method&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;http_referrer&quot;: &quot;$http_referer&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;http_x_forwarded_for&quot;: &quot;$http_x_forwarded_for&quot;, &#x27;</span><br><span class="line">        #&#x27;&quot;http_cdn_src_ip&quot;: &quot;$http_cdn_src_ip&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;http_user_agent&quot;: &quot;$http_user_agent&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;request_host&quot;: &quot;$host&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;scheme&quot;: &quot;$scheme&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;country_name&quot;: &quot;$geoip_country_name&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;region&quot;: &quot;$geoip_org&quot;, &#x27;</span><br><span class="line">        &#x27;&quot;cityname&quot;: &quot;$geoip_city&quot;&#x27;</span><br><span class="line">        #&#x27;&quot;$name&quot;: &quot;$value&quot;&#x27;</span><br><span class="line">        &#x27;&#125;&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h3 id="module-install"><a href="#module-install" class="headerlink" title="module install"></a>module install</h3><h4 id="geoip-module"><a href="#geoip-module" class="headerlink" title="geoip_module"></a>geoip_module</h4><ol>
<li>install<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get install nginx-plus-module-njs</span><br></pre></td></tr></table></figure></div></li>
<li>config<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">load_module ngx_stream_proxy_module</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h4 id="apt-get-install-nginx-module-geoip"><a href="#apt-get-install-nginx-module-geoip" class="headerlink" title="apt-get install nginx-module-geoip"></a>apt-get install nginx-module-geoip</h4><ol>
<li><p>install</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get install nginx-module-geoip</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>config</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">load_module &quot;modules/ngx_http_geoip_module.so&quot;;</span><br></pre></td></tr></table></figure></div></li>
</ol>
]]></content>
      <tags>
        <tag>middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>jenkinsfile</title>
    <url>/2023/04/10/jenkinsfile/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Groovy"><figure class="iseeu highlight groovy"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   environment &#123;</span><br><span class="line">        GKE_UAT_NAMESPACE=credentials(<span class="string">&quot;lg-k8s-cluster-uat&quot;</span>)</span><br><span class="line">        GKE_PRD_NAMESPACE=credentials(<span class="string">&quot;lg-k8s-cluster-prd&quot;</span>)</span><br><span class="line">        GKE_PROJECT_ID=credentials(<span class="string">&quot;gke-project-id&quot;</span>)</span><br><span class="line">        GKE_CLUSTER_NAME=<span class="string">&quot;lg-cluster&quot;</span></span><br><span class="line">        GKE_REGION=credentials(<span class="string">&quot;gke-location&quot;</span>)</span><br><span class="line">        GKE_CREDENTIALS_ID=<span class="string">&quot;gke-uat&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;Deploy to GKE&#x27;</span>) &#123;</span><br><span class="line">             steps &#123;</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                withCredentials([file(<span class="attr">credentialsId:</span> GKE_CREDENTIALS_ID, <span class="attr">variable:</span> <span class="string">&#x27;GCLOUD_CRES&#x27;</span>)]) &#123;</span><br><span class="line">                    </span><br><span class="line">                    script &#123;</span><br><span class="line">                        </span><br><span class="line">                        ansiColor() &#123;</span><br><span class="line">                            echo <span class="string">&#x27;\033[34m- auth&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        bat <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                            gcloud auth activate-service-account --key-file=&quot;$GCLOUD_CRES&quot;</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span></span><br><span class="line">                        </span><br><span class="line">                        ansiColor() &#123;</span><br><span class="line">                            echo <span class="string">&#x27;\033[34m- container&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        bat <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                            gcloud container clusters get-credentials $GKE_CLUSTER_NAME --region $GKE_REGION --project $GKE_PROJECT_ID</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                        <span class="comment">// application</span></span><br><span class="line">                        <span class="keyword">if</span> (type == <span class="string">&#x27;application&#x27;</span>) &#123;</span><br><span class="line">                            </span><br><span class="line">                            ansiColor() &#123;</span><br><span class="line">                                echo <span class="string">&#x27;\033[31m- delete config : application&#x27;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// bat &quot;&quot;&quot;</span></span><br><span class="line">                            <span class="comment">//     kubectl -n $GKE_NAMESPACE delete cm application</span></span><br><span class="line">                            <span class="comment">// &quot;&quot;&quot;</span></span><br><span class="line">                            </span><br><span class="line">                            ansiColor() &#123;</span><br><span class="line">                                echo <span class="string">&#x27;\033[34m- create config : application&#x27;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// bat &quot;&quot;&quot;</span></span><br><span class="line">                            <span class="comment">//     kubectl -n $GKE_NAMESPACE create cm application --from-file=config/application.yml</span></span><br><span class="line">                            <span class="comment">// &quot;&quot;&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// services</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            </span><br><span class="line">                            ansiColor() &#123;</span><br><span class="line">                                echo <span class="string">&#x27;\033[34m- deploy services&#x27;</span></span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                  </span><br><span class="line">                            bat <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                            kubectl -n $&#123;params.NAMESPACE&#125; apply -f kubernetes</span></span><br><span class="line"><span class="string">                            &quot;&quot;&quot;</span></span><br><span class="line">                    </span><br><span class="line">                            </span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title>live</title>
    <url>/2023/04/07/live/</url>
    <content><![CDATA[<ul>
<li><p>videojs-landscape-fullscreen.min.js</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/prateekrastogi/videojs-landscape-fullscreen.git</span><br><span class="line">cd videojs-landscape-fullscreen/</span><br><span class="line">cp videojs-landscape-fullscreen.min.js  /srs/objs/nginx/html/videojs/</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>rtc_player.html</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>LIVE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.min.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery-1.10.2.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/adapter-7.4.0.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/srs.sdk.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/winlin.utility.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/srs.page.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;videojs/videojs-landscape-fullscreen.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#000000;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txt_url&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;rtc_media_player&quot;</span>  <span class="attr">muted</span>=<span class="string">&quot;src&quot;</span>  <span class="attr">autoplay</span> <span class="attr">x-webkit-airplay</span>=<span class="string">&quot;true&quot;</span> <span class="attr">x5-playsinline</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">webkit-playsinline</span>=<span class="string">&quot;true&quot;</span> <span class="attr">playsinline</span>=<span class="string">&quot;true&quot;</span>  <span class="attr">x5-video-player-type</span>=<span class="string">&quot;h5&quot;</span> <span class="attr">x5-video-player-fullscreen</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">&quot; width: 100%;height: calc(100% - 1px);&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> sdk = <span class="literal">null</span>; <span class="comment">// Global handler to do cleanup when replaying.</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> startPlay = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Close PC when user replay.</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (sdk) &#123;</span></span><br><span class="line"><span class="language-javascript">            sdk.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        sdk = <span class="keyword">new</span> <span class="title class_">SrsRtcPlayerAsync</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// https://webrtc.org/getting-started/remote-streams</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">prop</span>(<span class="string">&#x27;srcObject&#x27;</span>, sdk.<span class="property">stream</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Optional callback, SDK will add track to stream.</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// sdk.ontrack = function (event) &#123; console.log(&#x27;Got track&#x27;, event); sdk.stream.addTrack(event.track); &#125;;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// For example: webrtc://r.ossrs.net/live/livestream</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> url = $(<span class="string">&quot;#txt_url&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">        sdk.<span class="title function_">play</span>(url).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">session</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&#x27;#sessionid&#x27;</span>).<span class="title function_">html</span>(session.<span class="property">sessionid</span>);</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&#x27;#simulator-drop&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>, session.<span class="property">simulator</span> + <span class="string">&#x27;?drop=1&amp;username=&#x27;</span> + session.<span class="property">sessionid</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            sdk.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">error</span>(reason);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> query = <span class="title function_">parse_query_string</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">srs_init_rtc</span>(<span class="string">&quot;#txt_url&quot;</span>, query);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&quot;#btn_play&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">prop</span>(<span class="string">&#x27;muted&#x27;</span>, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">startPlay</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (query.<span class="property">autostart</span> === <span class="string">&#x27;true&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#rtc_media_player&#x27;</span>).<span class="title function_">prop</span>(<span class="string">&#x27;muted&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">startPlay</span>();</span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">landscapeFullscreen</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>os config</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">sysctl net.core.rmem_max=16777216</span><br><span class="line">sysctl net.core.rmem_default=16777216</span><br><span class="line">sysctl net.core.wmem_max=16777216</span><br><span class="line">sysctl net.core.wmem_default=16777216</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>enable srt</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/ossrs/srs</span><br><span class="line">cd srs/trunk</span><br><span class="line">sudo ./configure --srt=on &amp;&amp; make</span><br></pre></td></tr></table></figure></div>

</li>
<li><p>srt2rtc.conf</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">listen              1935;</span><br><span class="line">max_connections     1000;</span><br><span class="line">daemon              off;</span><br><span class="line">srs_log_tank        console;</span><br><span class="line"></span><br><span class="line">http_api &#123;</span><br><span class="line">    enabled         on;</span><br><span class="line">    listen          1985;</span><br><span class="line">    https &#123;</span><br><span class="line">    enabled off;</span><br><span class="line">        listen 1990;</span><br><span class="line">        key  /ssl/push.dtlive.net.key;</span><br><span class="line">        cert /ssl/push.dtlive.net.crt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http_server &#123;</span><br><span class="line">    enabled         on;</span><br><span class="line">    listen          8080;</span><br><span class="line">    dir             ./objs/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">srt_server &#123;</span><br><span class="line">    enabled on;</span><br><span class="line">    listen 10088;</span><br><span class="line">    maxbw 1000000000;</span><br><span class="line">    connect_timeout 4000;</span><br><span class="line">    peerlatency 300;</span><br><span class="line">    recvlatency 300;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rtc_server &#123;</span><br><span class="line">    enabled on;</span><br><span class="line">    # Listen at udp://8000</span><br><span class="line">    listen 8000;</span><br><span class="line">    #</span><br><span class="line">    # The $CANDIDATE means fetch from env, if not configed, use * as default.</span><br><span class="line">    #</span><br><span class="line">    # The * means retrieving server IP automatically, from all network interfaces,</span><br><span class="line">    # @see https://github.com/ossrs/srs/wiki/v4_CN_WebRTC#config-candidate</span><br><span class="line">    candidate 35.220.173.105;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># @doc https://github.com/ossrs/srs/issues/1147#issuecomment-577607026</span><br><span class="line">vhost __defaultVhost__ &#123;</span><br><span class="line">    rtc &#123;</span><br><span class="line">        enabled     on;</span><br><span class="line">        # @see https://github.com/ossrs/srs/wiki/v4_CN_WebRTC#rtmp-to-rtc</span><br><span class="line">        rtmp_to_rtc on;</span><br><span class="line">        # @see https://github.com/ossrs/srs/wiki/v4_CN_WebRTC#rtc-to-rtmp</span><br><span class="line">        rtc_to_rtmp off;</span><br><span class="line">    &#125;</span><br><span class="line">    http_remux &#123;</span><br><span class="line">        enabled     on;</span><br><span class="line">        mount       [vhost]/[app]/[stream].flv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    hls &#123;</span><br><span class="line">        enabled         on;</span><br><span class="line">        hls_fragment    1;</span><br><span class="line">        hls_window      5;</span><br><span class="line">        hls_path        ./objs/nginx/html;</span><br><span class="line">        hls_m3u8_file   [app]/[stream].m3u8;</span><br><span class="line">        hls_ts_file     [app]/[stream]-[seq].ts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>nginx.conf</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">load_module &quot;/usr/share/nginx/modules/ngx_stream_module.so&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  play.dtlive.net push.dtlive.net *.dtlive.net 54.169.209.143;</span><br><span class="line">#    rewrite ^(.*)$ https://$host$1 permanent;</span><br><span class="line">    #  return 301 https://$host$request_uri;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /srs/objs/nginx/html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">             add_header Cache-Control no-cache;</span><br><span class="line">             add_header Access-Control-Allow-Origin *;</span><br><span class="line">             add_header Access-Control-Allow-Headers X-Requested-With;</span><br><span class="line">             add_header Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen   443 ssl http2;</span><br><span class="line">        server_name play.dtlive.net  push.dtlive.net *.dtlive.net 54.169.209.143;</span><br><span class="line">        ssl_certificate      /ssl/push.dtlive.net.crt;</span><br><span class="line">        ssl_certificate_key  /ssl/push.dtlive.net.key;</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line"></span><br><span class="line">        if ( $request_uri = &quot;/&quot; ) &#123;</span><br><span class="line">        rewrite &quot;/&quot; https://play.dtlive.net/players/rtc_player.html?schema=https&amp;api=1990&amp;stream=G26&amp;autostart=true break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /srs/objs/nginx/html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">             add_header Cache-Control no-cache;</span><br><span class="line">             add_header Access-Control-Allow-Origin *;</span><br><span class="line">             add_header Access-Control-Allow-Headers X-Requested-With;</span><br><span class="line">             add_header Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li><p>visit link</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://play.dtlive.net/players/rtc_player.html?schema=https&amp;api=1990&amp;stream=G25&amp;autostart=true</span><br></pre></td></tr></table></figure></div></li>
</ul>
]]></content>
  </entry>
</search>
